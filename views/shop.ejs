<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">
    <title>BagVerse | Shop</title>
    <style>
        @keyframes slideFade {
            0% {
                opacity: 0;
                transform: translateY(-50%, -10px);
            }

            100% {
                opacity: 1;
                transform: translateY(-50%, 0);
            }
        }

        .flash-success {
            animation: slideFade 0.3s ease-out;
        }
    </style>
</head>

<body class="bg-gray-50 pt-[90px]">

    <%- include("partials/header") %>

        <div class="flex flex-col lg:flex-row px-4 md:px-8 lg:px-10 pb-10 gap-6 lg:gap-10">

            <!-- Mobile Filters Button -->
            <button onclick="toggleFilters()" class="lg:hidden bg-black text-white px-4 py-2 rounded-md w-fit">
                Filters <i class="ri-filter-3-line"></i>
            </button>

            <% if (success && success.length> 0) { %>
                <div class="flash-success fixed 
    top-[80px] left-1/2 -translate-x-1/2 
    w-[90%] sm:w-[70%] md:w-[40%] lg:w-[25%]
    bg-green-100 border-l-4 border-green-500 text-green-800 
    px-4 py-3 rounded-md shadow-md z-50 text-center">

                    <span class="block text-sm sm:text-base font-medium">
                        <%= success[0] %>
                    </span>
                </div>
                <% } %>


                    <!-- SIDEBAR -->
                    <aside id="filters" class="w-full lg:w-64 bg-white shadow rounded-lg p-6 h-fit 
                  sticky lg:top-[90px] hidden lg:block">

                        <h3 class="text-lg font-semibold mb-4 text-gray-700">Sort By</h3>
                        <form action="/shop" method="GET">
                            <select name="sortby"
                                class="w-full border rounded-lg px-3 py-2 bg-gray-100 focus:bg-white focus:ring-2 focus:ring-black">
                                <option value="popular">Popular</option>
                                <option value="newest">Newest</option>
                                <option value="lowtohigh">Price: Low to High</option>
                                <option value="hightolow">Price: High to Low</option>
                            </select>
                        </form>

                        <h3 class="text-lg font-semibold mt-8 mb-4 text-gray-700">Categories</h3>
                        <div class="flex flex-col gap-2">
                            <a class="hover:text-black text-gray-600" href="">New Collection</a>
                            <a class="hover:text-black text-gray-600" href="">All Products</a>
                            <a class="hover:text-black text-gray-600" href="">Discounts</a>
                        </div>

                        <h3 class="text-lg font-semibold mt-8 mb-4 text-gray-700">Filters</h3>
                        <div class="flex flex-col gap-2">
                            <a class="hover:text-black text-gray-600" href="">Availability</a>
                            <a class="hover:text-black text-gray-600" href="">Discount Range</a>
                        </div>

                    </aside>

                    <script>
                        function toggleFilters() {
                            const f = document.getElementById("filters");
                            f.classList.toggle("hidden");
                        }
                    </script>

                    <!-- PRODUCTS GRID -->
                    <main class="flex-1">
                        <h2 class="text-2xl font-bold mb-6 text-gray-700">Shop All Bags</h2>

                        <!-- Responsive Grid: 2 / 3 / 4 columns -->
                        <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5">

                            <% products.forEach(function(product){ %>
                                <div class="w-full">
                                    <div class="w-full h-40 sm:h-48 md:h-52 flex items-center justify-center 
                            bg-[<%= product.bgcolor %>]">
                                        <img class="h-28 sm:h-36 md:h-48"
                                            src="data:image/jpeg;base64,<%= product.image.toString('base64') %>"
                                            alt="<%= product.name %>">
                                    </div>

                                    <div class="flex justify-between bg-[<%= product.panelcolor %>] items-center 
                            px-4 py-4 text-[<%= product.textcolor %>]">
                                        <div>
                                            <h3>
                                                <%= product.name %>
                                            </h3>
                                            <h4>â‚¹ <%= product.price %>
                                            </h4>
                                        </div>

                                        <a class="w-7 h-7 flex items-center justify-center rounded-full bg-white"
                                            href="/addtocart/<%= product._id %>">
                                            <i class="ri-add-line text-black font-bold"></i>
                                        </a>
                                    </div>
                                </div>
                                <% }) %>

                        </div>
                    </main>

        </div>

        <%- include("partials/footer") %>


            <script>
                setTimeout(() => {
                    const flash = document.querySelector(".flash-success");
                    if (flash) {
                        flash.style.transition = "opacity 0.4s ease";
                        flash.style.opacity = "0";

                        setTimeout(() => flash.remove(), 400);
                    }
                }, 3000);
            </script>


</body>

</html>